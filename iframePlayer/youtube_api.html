<!--
  ~ HKNBP_Core is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as published by
  ~ the Free Software Foundation, either version 3 of the License, or
  ~ (at your option) any later version.
  ~
  ~ HKNBP_Core is distributed in the hope that it will be useful,
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with HKNBP_Core.  If not, see <https://www.gnu.org/licenses/>.
  -->

<!DOCTYPE html>
<html lang="hk">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<video
        id="player-display"
        style="position:absolute; top:0; bottom:0; left:0; right:0; width:100%; height:100%; overflow:hidden;"
        frameBorder="0"
        allow="autoplay; fullscreen">
</video>
<script>
    /**
     * This code loads the IFrame Player API code asynchronously.
     */
    var tag = document.createElement('script');
    var firstScriptTag = document.getElementsByTagName('script')[0];
    /**
     * This function creates an <iframe> (and YouTube player)
     * after the API code downloads.
     */
    var player;
    var youtubeVideoId;

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player-display', {
            videoId : youtubeVideoId,
            playerVars : {
                'autoplay'          : 1,    // Auto-play the video on load
                'autohide'          : 1,    // Hide video controls when playing
                'controls'          : 0,    // Show pause/play buttons in player
                'cc_load_policy'    : 3,    // Hide closed captions
                'enablejsapi'       : 1,
                'fs'                : 0,    // Hide the full screen button
                'frameborder'       : 0,
                'showinfo'          : 0,    // Hide the video title
                'mute'              : 1,
                'modestbranding'    : 1,    // Hide the Youtube Logo
                'loop'              : 1,    // Run the video in a loop
                'iv_load_policy'    : 3     // Hide the Video Annotations
            },
            events : {
                'onReady' : onPlayerReady,
                'onStateChange' : onPlayerStateChange,
                'onPlaybackQualityChange': onPlaybackQualityChange,
                'onError': onPlayerError
            }
        });
        player.addEventListener("onStateChange", "onPlayerStateChange");
    }

    /**
     * The API will call this function when the video player is ready.
     */
    function onPlayerReady(event) {
        player.setVolume(100);
    }

    /**
     *	The API calls this function when the player's state changes.
     *  The function indicates that when playing a video (state=1),
     *  the player should play for six seconds and then stop.
     */
    function onPlayerStateChange(event) {
        if(event.data === YT.PlayerState.PLAYING){
            onIframePlayerPlaying();
        }else{
            onIframePlayerNotPlaying();
        }
    }

    function onPlaybackQualityChange(event) {

    }

    function onPlayerError(event) {
        setTimeout(function () {
            if (player.getPlayerState() !== 1){
                onIframePlayerNotPlaying();
            }
        }, 15000);
    }

    /**
     * Track嘅class
     * @param {String} id Track嘅編號,用來識別
     * @param {String} name Track嘅名
     * */
    function TrackDescription(id, name){
        var obj = {};
        obj.id = id;
        obj.name = name;

        return obj;
    }

    /**
     * 呢個value係個function()
     * 呢個function()初始化會響HKNBP_Core開啟呢個IframePlayer時初始化
     * 當播放器播放緊頻道時
     * 需要設定call呢個function()
     * 向HKNBP_Core發送呢個IframePlayer嘅播放器正播放緊頻道
     * */
    var onIframePlayerPlaying;

    /**
     * 呢個value係個function()
     * 呢個function()初始化會響HKNBP_Core開啟呢個IframePlayer時初始化
     * 當播放器冇播放頻道時
     * 需要設定call呢個function()
     * 向HKNBP_Core發送呢個IframePlayer嘅播放器依家冇播放緊頻道
     * 如call左一次onIframePlayerNotPlaying()
     * 響15之內冇再call onIframePlayerPlaying()嘅話
     * 將會刷新此IframePlayer
     * */
    var onIframePlayerNotPlaying;

    /**
     * 由HKNBP_Core發出初始化IframePlayer
     * @param {String} source 頻道源
     * */
    function onIframePlayerInit(sourceSrc){
        youtubeVideoId = sourceSrc;
        tag.src = "https://www.youtube.com/iframe_api";
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    }


    /******************************************************************************************************************/
    /**
     * 由HKNBP_Core開啟呢個IframePlayer去設定videoTrack
     * @param {TrackDescription} videoTrack 當執行設定videoTrack時嘅videoTrack參數
     * */
    function onSetIframePlayerVideoTrack(videoTrack) {

    }

    /**
     * 由HKNBP_Core開啟呢個IframePlayer去獲取videoTrack
     * @returns {TrackDescription} videoTrack
     * */
    function onGetIframePlayerVideoTrack() {
        return TrackDescription(-1, "自動");
    }

    /**
     * 由HKNBP_Core開啟呢個IframePlayer去獲取所有videoTrack資訊
     * @returns {TrackDescription[]} 所有videoTrack資訊
     * */
    function onGetIframePlayerVideoTracks() {

    }

    /******************************************************************************************************************/
    /**
     * 由HKNBP_Core開啟呢個IframePlayer去設定audioTrack
     * @param {TrackDescription} audioTrack 當執行設定audioTrack時嘅audioTrack參數
     * */
    function onSetIframePlayerAudioTrack(audioTrack) {

    }

    /**
     * 由HKNBP_Core開啟呢個IframePlayer去獲取audioTrack
     * @returns {TrackDescription} audioTrack
     * */
    function onGetIframePlayerAudioTrack() {
        return TrackDescription(0, "聲道1");
    }

    /**
     * 由HKNBP_Core開啟呢個IframePlayer去獲取所有audioTrack資訊
     * @returns {TrackDescription} 所有audioTrack資訊
     * */
    function onGetIframePlayerAudioTracks() {

    }

    /******************************************************************************************************************/
    /**
     * 由HKNBP_Core開啟呢個IframePlayer去設定subtitleTrack
     * @param {TrackDescription} subtitleTrack 當執行設定subtitleTrack時嘅subtitleTrack參數
     * */
    function onSetIframePlayerSubtitleTrack(subtitleTrack) {
        //直接i由1開始上, 因第0係選項無字幕, 唔需要作"showing"設定
        for(var i=1; i<player.textTracks().length; i++){
            //i-1係因為textTracks由0開始為第1個字幕
            if(i === subtitleTrack.id){
                player.textTracks()[i-1].mode = "showing";
            }else{
                player.textTracks()[i-1].mode = "hidden";
            }
        }
    }

    /**
     * 由HKNBP_Core開啟呢個IframePlayer去獲取subtitleTrack
     * @returns {TrackDescription} subtitleTrack
     * */
    function onGetIframePlayerSubtitleTrack() {
        for(var i=0; i<player.textTracks().length; i++){
            if(player.textTracks()[i].mode === "showing"){
                return TrackDescription(i, player.textTracks()[i].label);
            }
        }
        return TrackDescription(0, "無字幕");
    }

    /**
     * 由HKNBP_Core開啟呢個IframePlayer去獲取所有subtitleTrack資訊
     * @returns {TrackDescription[]} 所有subtitleTrack資訊
     * */
    function onGetIframePlayerSubtitleTracks() {
        //console.log(player.textTracks()[0].activeCues);
        var subtitleTracks = [];
        subtitleTracks[0] = TrackDescription(0, "無字幕");//設定無字幕選項
        var j = 1;
        for(var i=0; i<player.textTracks().length; i++){
            if(player.textTracks()[i].kind === "subtitles" || player.textTracks()[i].kind === "caption"){
                subtitleTracks[j] = TrackDescription(i+1, player.textTracks()[i].label);//因有無字幕選項響0, 所以之後字幕為i+1
                j++;
            }
        }
        return subtitleTracks;
    }


    /**
     * 由HKNBP_Core發出音量值讀取
     * @returns {Number} 現在音量 數值由0-100之間,100為最大音量
     * */
    function onGetIframePlayerVolume() {
        return player.getVolume();
    }

    /**
     * 由HKNBP_Core發出音量值讀取
     * @param {Number} value 欲設音量 數值由0-100之間,100為最大音量
     * */
    function onSetIframePlayerVolume(value) {
        player.setVolume(value);
    }

    /**
     * 由HKNBP_Core發出靜音值讀取
     * @returns {Boolean} 靜左音(true) 或 未靜音(false)
     * */
    function onGetIframePlayerMuted() {
        return player.isMuted();
    }

    /**
     * 由HKNBP_Core發出靜音值讀取
     * @param {Boolean} value 欲設靜音
     * */
    function onSetIframePlayerMuted(value) {
        if(value){player.mute();}else{player.unMute();}
    }
</script>
</body>
</html>
